{% extends "layout.html" %}
{% block content %}
<style media="screen">
.clear { clear:both; }

</style>
<script>
$(document).ready(function(){
    $("#rent-device").click(function() {
      if ('{{user_profile.phone_number}}' != '') {
        $("#rent-device-modal").modal({
          closable  : true,
          onDeny    : function(){
            return true;
          },
          onApprove : function() {
            $.ajax({
              url : "/api/rent/", // the endpoint
              type : "GET", // http method
              data : { user : '{{user.username}}', device: '{{device.name}}', event: '{{event.name}}'},
              success : function(data) {
                alertify.alert("You successfully reserved a {{device.name}}");
                $('#reservations')
                .replaceWith(data); // log the returned json to the console
                  
              }, 
              error: function(data) {
                alertify.alert(data.responseText);
              }
            });
          },
        }).modal('show');
      } else {
        alertify.alert("Please go to the settings page and enter your phone number");
      }
    });
});
</script>

<div class="ui center aligned basic segment">
  <h1 class="ui header">{{event}}
    <div class="sub header">HardwareLab</div>
  </h1>
</div>

<div class="ui segment clearing">
  <img class="ui medium rounded image floated left" src="/media/{{device.image}}" alt="">

  <h1 class="ui header teal">{{device.name}}
    <div class="sub header">{{device.manufacturer}}</div>
  </h1>
  <p>{{device.description}}</p>
  {% if user.is_authenticated %}
    <a id="rent-device" class="ui button">Reserve Device</a>
  {% endif %}

</div>

<div class="ui basic floated right segment" style="min-width:400px"> 
  <div id="reservations">
    {% include "partials/device_rentals.html" %}
  </div>    
</div>

<div id="rent-device-modal" class="ui modal small">
  <div class="ui icon header">
  <i class="archive icon"></i>
    Reserve Device <br/>
    <small>Do you want to reserve a {{device.name}}?</small>
  </div>

  <div class="actions centered">
    
      <div class="ui cancel button">
        <i class="remove icon"></i>
        My bad!
      </div>
      <div class="ui teal approve button">
        <i class="checkmark icon"></i>
        Yes, please!
      </div>  
  </div>
</div>


{% endblock %}